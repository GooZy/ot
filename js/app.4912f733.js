(function(t){function e(e){for(var n,i,l=e[0],s=e[1],c=e[2],h=0,f=[];h<l.length;h++)i=l[h],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&f.push(r[i][0]),r[i]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);u&&u(e);while(f.length)f.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var t,e=0;e<o.length;e++){for(var a=o[e],n=!0,l=1;l<a.length;l++){var s=a[l];0!==r[s]&&(n=!1)}n&&(o.splice(e--,1),t=i(i.s=a[0]))}return t}var n={},r={app:0},o=[];function i(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=n,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(a,n,function(e){return t[e]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/ot/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],s=l.push.bind(l);l.push=e,l=l.slice();for(var c=0;c<l.length;c++)e(l[c]);var u=s;o.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),r=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("h1",[t._v("Welcome to OT!")]),e("el-tabs",{staticStyle:{height:"100%"},attrs:{"tab-position":"left"},on:{"tab-click":t.handleClick},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[t._l(t.monthList,(function(a,n){return e("el-tab-pane",{attrs:{label:a,name:n+"",id:n=""}},[t._v(" "+t._s(a)+" ORK情况一览 ")])})),e("router-view")],2)],1)},o=[];function i(t){var e=function(t){return t<10?"0"+t:t+""},a=[],n=(new Date).getMonth()+3,r=(new Date).getFullYear();n>12&&(r+=1,n=1);for(var o=r;o>=t;--o){for(var i=n;i>0;i-=2){var l=2*Math.ceil(i/2);a.push(o+"."+e(l-1)+"~"+o+"."+e(l))}n=12}return a}var l={data:function(){return{activeTab:"",monthList:[]}},methods:{handleClick:function(t){this.$router.push({path:"/okr/",query:{month:t.label}}).catch((function(){}))}},created:function(){this.activeTab="1",this.monthList=i(2020);var t=this.monthList[this.activeTab];this.$router.push({path:"/okr/",query:{month:t}}).catch((function(){}))}},s=l,c=(a("71ad"),a("2877")),u=Object(c["a"])(s,r,o,!1,null,null,null),h=u.exports,f=a("8c4f"),d=function(){var t=this,e=t._self._c;return e("div",[null===t.tableData||0===t.tableData.length?e("el-card",[e("h1",[t._v("暂无目标")])]):t._e(),t._l(t.tableData,(function(a,n){return e("el-card",{staticClass:"box-card",staticStyle:{"margin-bottom":"10px"}},[e("span",{staticClass:"card-top"},[t._v("目标"+t._s(n+1)+": "+t._s(a.object))]),e("div",{staticStyle:{float:"right",padding:"5px 0"}},[e("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(e){return t.modifyObject(n)}}}),e("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(e){return t.deleteTable(n)}}})],1),e("el-table",{staticStyle:{width:"100%","margin-top":"10px","margin-left":"10px"},attrs:{data:a.data,border:""},on:{"cell-dblclick":t.cellDbClick,"cell-mouse-leave":t.cellLeave}},[e("el-table-column",{attrs:{label:"关键结果","min-width":"35"},scopedSlots:t._u([{key:"default",fn:function(a){return[t.hitBox[a.row.object+a.row.index+a.column.label]?e("span",[e("el-input",{attrs:{type:"textarea",size:"small"},model:{value:a.row.key,callback:function(e){t.$set(a.row,"key",e)},expression:"scope.row.key"}})],1):e("span",[t._v(t._s(a.row.key))])]}}],null,!0)}),e("el-table-column",{attrs:{label:"当前进度","min-width":"18"},scopedSlots:t._u([{key:"default",fn:function(a){return[t.hitBox[a.row.object+a.row.index+a.column.label]?e("span",[e("el-input-number",{attrs:{size:"small",max:a.row.target,min:0},model:{value:a.row.result,callback:function(e){t.$set(a.row,"result",e)},expression:"scope.row.result"}})],1):e("span",[t._v(t._s(a.row.result))])]}}],null,!0)}),e("el-table-column",{attrs:{label:"目标值","min-width":"18"},scopedSlots:t._u([{key:"default",fn:function(a){return[t.hitBox[a.row.object+a.row.index+a.column.label]?e("span",[e("el-input",{attrs:{size:"small"},model:{value:a.row.target,callback:function(e){t.$set(a.row,"target",e)},expression:"scope.row.target"}})],1):e("span",[t._v(t._s(a.row.target))])]}}],null,!0)}),e("el-table-column",{attrs:{label:t.fixLabel,"min-width":"18"},scopedSlots:t._u([{key:"default",fn:function(a){return[t.hitBox[a.row.object+a.row.index+a.column.label]?e("span",[e("el-input",{attrs:{size:"small"},model:{value:a.row.weight,callback:function(e){t.$set(a.row,"weight",e)},expression:"scope.row.weight"}})],1):!1===t.hitBox[a.row.object+a.row.index+a.column.label]?e("span",[e("el-input",{attrs:{size:"small",disabled:""},model:{value:a.row.weight,callback:function(e){t.$set(a.row,"weight",e)},expression:"scope.row.weight"}})],1):e("span",[t._v(t._s(a.row.weight))])]}}],null,!0)}),e("el-table-column",{attrs:{label:"操作","min-width":"11"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(e){return t.deleteRow(a.row.object+a.row.key,n)}}})]}}],null,!0)})],1),e("el-col",[e("div",{staticClass:"el-table-add-row",staticStyle:{width:"99.2%"},on:{click:function(e){return t.preAddKey(n)}}},[e("span",[t._v("+ 添加")])])]),e("span",[t._v("当前总分："),e("b",[t._v(t._s(t.scoreList[n]))]),t._v(" (满分：100)")])],1)})),null!=t.tableData&&0!=t.tableData.length?e("el-card",[e("div",{staticClass:"card-top",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("评论：")])]),e("el-input",{attrs:{type:"textarea",autosize:"",placeholder:"请输入内容"},on:{change:t.saveData},model:{value:t.comments,callback:function(e){t.comments=e},expression:"comments"}})],1):t._e(),e("el-button",{staticStyle:{float:"left"},attrs:{type:"primary"},on:{click:t.newObject}},[t._v("新建目标")]),e("el-button",{staticStyle:{float:"left"},attrs:{type:"primary"},on:{click:t.exportData}},[t._v("导出数据")]),e("el-upload",{staticStyle:{float:"right"},attrs:{accept:"application/json",action:"not-exist","before-upload":t.importData,limit:1}},[e("el-button",{attrs:{type:"primary"}},[t._v("导入数据")])],1),e("el-dialog",{attrs:{title:"新建关键结果",visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[e("el-form",{ref:"form",attrs:{model:t.form}},[e("el-form-item",{attrs:{label:"关键结果",prop:"key",rules:[{required:!0,message:"关键结果不能为空"}]}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.key,callback:function(e){t.$set(t.form,"key",e)},expression:"form.key"}})],1),e("el-form-item",{attrs:{label:"目标值",prop:"target",rules:[{required:!0,message:"目标值不能为空"},{type:"number",message:"目标值必须为数字值"}]}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.target,callback:function(e){t.$set(t.form,"target",t._n(e))},expression:"form.target"}})],1)],1),e("div",[e("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.addNewKey("form")}}},[t._v("确 定")])],1)],1)],2)},m=[],p=(a("d3b7"),a("159b"),a("b680"),a("e9c4"),a("25f0"),a("a434"),a("ac1f"),a("5319"),a("21a6")),g=a.n(p),b=(a("4be7"),{data:function(){return{month:"",scoreList:[],hitBox:{},fixLabel:"占比(%)",form:{},editData:!1,dialogFormVisible:!1,commentsPre:"comments",comments:"",tableData:[{object:"兴趣相关能力提升",data:[{index:"0",object:"兴趣相关能力提升",key:"出口仁大家的日本语剩余35课完成",result:10,target:35,weight:30},{index:"1",object:"兴趣相关能力提升",key:"OT web版发布",result:1,target:10,weight:60},{index:"2",object:"兴趣相关能力提升",key:"看完《百年孤独》",result:6,target:10,weight:10}]},{object:"兴趣相关能力提升2",data:[{index:"0",object:"兴趣相关能力提升2",key:"出口仁大家的日本语剩余35课完成",result:10,target:35,weight:30},{index:"1",object:"兴趣相关能力提升2",key:"OT web版发布",result:1,target:10,weight:40},{index:"2",object:"兴趣相关能力提升2",key:"看完《百年孤独》",result:6,target:10,weight:30}]}]}},methods:{initData:function(t){this.month=this.$route.query.month,this.tableData=[],this.scoreList=[],this.comments="",this.form={key:"",target:0,index:-1},this.dialogFormVisible=!1,t||(this.hitBox={},this.editData=!1);var e=localStorage.getItem(this.month),a=localStorage.getItem(this.commentsPre+this.month);e=JSON.parse(e),a=JSON.parse(a),e&&0!==e.length&&(this.tableData=e,this.preUpdate(e)),a&&(this.comments=a)},preUpdate:function(t){var e=this,a=[];t.forEach((function(t){var n=0;if(0!==t.data.length){t.data.forEach((function(t){n+=t.result/t.target*t.weight}));var r=t.data[t.data.length-1];e.hitBox[r.object+r.index+e.fixLabel]=!1}isNaN(n)&&(n=0),a.push(n.toFixed(2))})),this.scoreList=a},cellDbClick:function(t,e){var a=t.object+t.index+e.label;isNaN(this.hitBox[a])&&(this.hitBox[a]=!0,this.editData=!0,this.initData(!0))},cellLeave:function(t,e){this.editData&&(this.formatData(t,e)&&this.saveData(),this.initData())},saveData:function(){localStorage.setItem(this.month,JSON.stringify(this.tableData)),0===this.tableData.length&&(this.comments=""),localStorage.setItem(this.commentsPre+this.month,JSON.stringify(this.comments)),this.sendMsg("数据保存成功","success",1e3)},formatData:function(t,e){var a=localStorage.getItem(this.month);if(a===JSON.stringify(this.tableData))return!1;a=JSON.parse(a);for(var n=0;n<this.tableData.length;n++)for(var r=this.tableData[n].data,o=0;o<r.length;o++){var i=r[o];if("number"!==typeof i.target){if(parseInt(i.target).toString()!==i.target)return this.sendMsg("请输入整数","error",1500),!1;i.target=parseInt(i.target)}if("number"!==typeof i.weight){if(parseInt(i.weight).toString()!==i.weight)return this.sendMsg("请输入整数","error",1500),!1;i.weight=parseInt(i.weight)}if(i.target<i.result)return this.sendMsg("目标值不得小于当前进度","error",1500),!1;if(i.weight>100)return this.sendMsg("占比最高为100","error",1500),!1;if(e.label===this.fixLabel&&i.object===t.object&&i.key===t.key){var l=a[n].data.length-1,s=a[n].data[o].weight+a[n].data[l].weight;i.weight>s&&(i.weight=s),r[l].weight=s-i.weight}for(var c=0;c<r.length;c++){var u=r[c];if(c!==o&&u.key===i.key)return this.sendMsg("关键结果不能相同","error",1500),!1}}return!0},deleteRow:function(t){var e=this;this.$confirm("将要删除当前关键结果, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){for(var a=0;a<e.tableData.length;a++)for(var n=0;n<e.tableData[a].data.length;n++){var r=e.tableData[a].data,o=r[n];o.object+o.key===t&&(1!==r.length&&(n===r.length-1?r[r.length-2].weight+=r[n].weight:r[r.length-1].weight+=r[n].weight),r.splice(n,1))}e.saveData(),e.initData()})).catch(this.logMessage)},deleteTable:function(t){var e=this;this.$confirm("将要删除当前目标, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.tableData.splice(t,1),e.saveData(),e.initData()})).catch(this.logMessage)},modifyObject:function(t){var e=this;this.$prompt("原目标："+this.tableData[t].object,"修改目标",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(a){var n=a.value;e.isEmpty(n)?e.sendMsg("目标不能为空","error",1500):(e.tableData[t].object=n,e.tableData[t].data.forEach((function(t){t.object=n})),e.saveData(),e.initData())})).catch(this.logMessage)},newObject:function(){var t=this;this.$prompt("","新建目标",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(e){var a=e.value;if(t.isEmpty(a))t.sendMsg("目标不能为空","error",1500);else{for(var n=0;n<t.tableData.length;n++)if(t.tableData[n].object===a)return void t.sendMsg("已经设定过相同的目标","error",1500);t.tableData.push({object:a,data:[]}),t.saveData(),t.initData()}})).catch(this.logMessage)},preAddKey:function(t){this.dialogFormVisible=!0,this.form.index=t},addNewKey:function(t){var e=this;this.$refs[t].validate((function(t){if(!t)return e.sendMsg("未通过校验","error",1500),!1;if(e.dialogFormVisible=!1,e.isEmpty(e.form.key))e.sendMsg("关键结果不能为空","error",1500);else{for(var a=e.tableData[e.form.index].data,n=0;n<a.length;n++)if(a[n].key===e.form.key)return void e.sendMsg("关键结果不能相同","error",1500);var r=0;0===a.length&&(r=100),a.push({object:e.tableData[e.form.index].object,key:e.form.key,result:0,target:e.form.target,weight:r,index:a.length+""}),e.saveData(),e.initData()}}))},exportData:function(){var t=this,e={},a=i(2020);a.forEach((function(a){e[a]=localStorage.getItem(a);var n=t.commentsPre+a;e[n]=localStorage.getItem(n)})),this.logMessage(e),g.a.saveAs(new Blob([JSON.stringify(e)],{type:""}),"ot.json")},importData:function(t){return this.$confirm("将会覆盖当前所有数据，是否继续?","提示",{confirmButtonText:"继续",cancelButtonText:"取消",type:"warning"}).then((function(){var e=new FileReader;e.onload=function(t){var e=JSON.parse(t.target.result);for(var a in e)localStorage.setItem(a,e[a]);location.reload()},e.readAsText(t)})).catch(this.logMessage),!1},isEmpty:function(t){return null===t||0===t.replace(/ /g,"").length},sendMsg:function(t,e,a){this.$message({message:t,type:e,duration:a})},logMessage:function(t){console.log(t)}},created:function(){this.initData()},watch:{$route:"initData"}}),v=b,w=(a("91e9"),Object(c["a"])(v,d,m,!1,null,null,null)),y=w.exports;n["default"].use(f["a"]);var x=[{path:"/okr/*",name:"home",component:y}],k=new f["a"]({mode:"history",base:"/ot/",routes:x}),D=k,_=a("2f62");n["default"].use(_["a"]);var j=new _["a"].Store({state:{},mutations:{},actions:{},modules:{}}),S=a("5c96"),O=a.n(S);a("0fae");n["default"].use(O.a),n["default"].config.productionTip=!1,new n["default"]({router:D,store:j,render:function(t){return t(h)}}).$mount("#app")},"5db1":function(t,e,a){},"71ad":function(t,e,a){"use strict";a("5db1")},"91e9":function(t,e,a){"use strict";a("dfc0")},dfc0:function(t,e,a){}});
//# sourceMappingURL=app.4912f733.js.map